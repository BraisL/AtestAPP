<!DOCTYPE html>
<html lang="es" data-sin-datos="1">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AtestApp - Diligencia libre (sin datos)</title>

  <link rel="stylesheet" href="../css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">

  <style>
    /* Mismas reglas que diligencialibre.html (prototipo) */
    .dl-wrap { padding: 1.2vw; max-width: 88vw; margin: 0 auto; }
    .dl-title { margin: 0 0 0.8vw 0; }
    .dl-help { margin: 0.2vw 0 1vw 0; line-height: 1.35; }

    .dl-link {
      color: inherit;
      text-decoration: underline;
      text-decoration-style: dotted;
      cursor: pointer;
      font-weight: 600;
    }
    .dl-link:hover { font-weight: 700; text-decoration-style: solid; }

    .dl-card {
      border: 0.15vw solid #ccc;
      border-radius: 0.25vw;
      padding: 1vw;
      background: #fff;
    }

    .dl-fields {
      display: flex;
      flex-wrap: wrap;
      gap: 1vw;
      align-items: flex-start;
    }

    .dl-field { display: flex; flex-direction: column; }
    .dl-field label { margin-bottom: 0.35vw; }
    .dl-field input, .dl-field textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 0.55vw;
      border: 0.15vw solid #ccc;
      border-radius: 0.25vw;
      font-family: 'Montserrat', sans-serif;
      font-size: 0.9vw;
    }
    .dl-field textarea { resize: vertical; min-height: 18vh; }

    .w-20 { min-width: 12vw; max-width: 12vw; }
    .w-30 { min-width: 18vw; max-width: 18vw; }
    .w-60 { min-width: 30vw; max-width: 30vw; }
    .w-100 { min-width: 100%; max-width: 100%; }

    .dl-actions {
      margin-top: 1.2vw;
      display: flex;
      flex-wrap: wrap;
      gap: 1vw;
    }

    #previewArea { display: none; margin-top: 1.2vw; }

    .doc-pages { display: grid; gap: 1.2vw; justify-content: center; }

    .sheet {
      position: relative;
      width: 60vw;
      height: calc(60vw * 1.4142);
      max-width: 70vh;
      max-height: calc(70vh * 1.4142);
      background: white;
      box-shadow: 0 1.2vh 3vh rgba(0,0,0,0.35);
      overflow: hidden;
    }

    .sheet-bg {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      z-index: 0;
    }

    .overlay { position: absolute; inset: 0; z-index: 1; }

    .field {
      position: absolute;
      color: #000;
      white-space: pre-wrap;
      word-break: break-word;
      font-size: 1.05vw;
      line-height: 1.25;
      font-family: 'Montserrat', sans-serif;
    }

    .field-atestado { top: 4.55%; left: 22.0%; width: 38%; height: 3.2%; font-weight: 700; }
    .field-folio    { top: 4.55%; left: 78.5%; width: 14%; height: 3.2%; font-weight: 700; text-align: left; }

    .field-titulo   { top: 10.0%; left: 10.0%; width: 80%; height: 4.0%; font-weight: 700; font-size: 1.15vw; }
    .field-texto    { top: 15.3%; left: 10.0%; width: 80%; height: 73.0%; }
    .field-footer   { top: 91.2%; left: 10.0%; width: 80%; height: 6.2%; font-size: 0.9vw; }

    .field-footer{
      display: flex;
      flex-wrap: wrap;
      gap: 0.4vw 1.2vw;
      align-content: flex-start;
      line-height: 1.15;
    }

    .field-footer .u-item{ display: inline-flex; gap: 0.35vw; flex: 0 1 auto; }
    .field-footer .u-label{ font-weight: 700; white-space: nowrap; }
    .field-footer .u-value{ white-space: normal; overflow-wrap: anywhere; }

    @page { size: A4; margin: 0; }
    @media print {
      html, body { width: 210mm; height: 297mm; margin: 0; padding: 0; background: white; }
      .dl-card, .dl-help, .dl-title, .dl-actions, #previewArea { display: none !important; }
      #printArea { display: block !important; }
      .doc-pages { gap: 0; }
      .sheet {
        width: 210mm;
        height: 297mm;
        max-width: none;
        max-height: none;
        box-shadow: none;
        page-break-after: always;
      }
      .sheet:last-child { page-break-after: auto; }
      .field { font-size: 11pt; }
      .field-titulo { font-size: 12pt; }
      .field-footer { font-size: 9pt; }
    }
  </style>
</head>

<body class="page">
  <main class="dl-wrap">
    <h2 class="dl-title">Diligencia libre (sin datos)</h2>

    <p class="dl-help">
      Prototipo: rellena los campos, previsualiza si lo necesitas y después imprime para guardar en PDF.
      Esta variante <strong>no inserta datos de unidad</strong> en el pie de página.
      Si ya tienes una diligencia guardada en <strong>.json</strong>, puedes
      <a class="dl-link" href="#" id="linkLoadJson">cargarla aquí</a>.
    </p>

    <input type="file" id="fileLoadJson" accept=".json" style="display:none;">

    <section class="dl-card">
      <div class="dl-fields">
        <div class="dl-field w-30">
          <label for="dlAtestado"><strong>Número de atestado</strong></label>
          <input id="dlAtestado" name="atestado" type="text" placeholder="Ej. 123/2025">
        </div>

        <div class="dl-field w-20">
          <label for="dlFolio"><strong>Folio</strong></label>
          <input id="dlFolio" name="folio" type="text" placeholder="Ej. 1">
        </div>

        <div class="dl-field w-60">
          <label for="dlNombre"><strong>Nombre de la diligencia *</strong></label>
          <input id="dlNombre" name="nombre" type="text" placeholder="Ej. Diligencia de exposición de hechos" required>
        </div>

        <div class="dl-field w-100">
          <label for="dlTexto"><strong>Texto</strong></label>
          <textarea id="dlTexto" name="texto" placeholder="Escribe aquí el texto..."></textarea>
        </div>
      </div>

      <div class="dl-actions">
        <button id="btnImprimir" type="button">IMPRIMIR (PDF)</button>
        <button id="btnPreview" type="button">PREVISUALIZAR</button>
        <button id="btnDownloadJson" type="button">DESCARGAR (.JSON)</button>
      </div>

      <div class="warnings" style="margin-top: 14px;">
        <p style="margin: 10px 0;"><strong>Explicación rápida</strong></p>
        <p style="margin: 6px 0;"><strong>Previsualizar:</strong> muestra/oculta la hoja para revisar el resultado antes de imprimir.</p>
        <p style="margin: 6px 0;"><strong>Imprimir</strong> abre el diálogo del navegador para imprimir (guardar en PDF o imprimir en físico). Si el texto no cabe, se generan páginas adicionales automáticamente.</p>
        <p style="margin: 6px 0;"><strong>Descargar:</strong> guarda esta diligencia en un .json para poder cargarla más adelante.</p>
      </div>
    </section>

    <section id="previewArea">
      <h3 style="margin: 0.8vw 0;">Previsualización</h3>
      <div id="previewPages" class="doc-pages"></div>
    </section>

    <section id="printArea" style="display:none;">
      <div id="printPages" class="doc-pages"></div>
    </section>
  </main>

  <script src="../js/utilidades.js"></script>
  <script src="../js/diligencialibre.js"></script>
  <script src="../js/iframe_autoaltura.js"></script>
</body>
</html>
